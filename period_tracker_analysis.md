# 经期追踪功能问题分析

## 发现的问题

### 1. 时间处理问题（核心问题）
- 前端使用 `startDate.toISOString()` 发送日期，这会转为UTC时间
- 用户在中国时区(UTC+8)选择2月12日，toISOString()会变成2月11日16:00:00Z
- 后端 `new Date(input.startDate)` 再解析时可能产生偏移
- 显示时 `new Date(record.startDate).toLocaleDateString('zh-CN')` 可能显示错误日期
- 解决方案：使用纯日期字符串 `YYYY-MM-DD` 格式传输，避免时区转换

### 2. 周期预测排序问题
- `records` 从数据库返回，但没有明确按时间排序
- `prediction` 计算中 `records[records.length - 1]` 假设最后一条是最新的
- 如果排序不对，预测会完全错误

### 3. 日历选择器体验问题
- 两个完整的Calendar组件占据大量空间
- 在手机上需要大量滚动
- 应该改为更紧凑的日期选择方式

### 4. 缺少周期长度(cycleLength)的计算
- 创建时没有自动计算cycleLength
- 应该根据上一次记录自动计算

## 优化方案

### 时间修复
- 日期传输改为 `YYYY-MM-DD` 格式字符串
- 后端存储时使用当天中午12:00避免时区偏移
- 显示时直接截取日期部分

### UI优化
- 用日期输入框替代Calendar组件（更紧凑）
- 添加"快速记录"按钮（一键记录今天来了）
- 记录卡片显示痛经和情绪图标
- 添加周期日历视图

### 功能优化
- 自动计算周期长度
- 排序确保按时间倒序
- 预测更准确
