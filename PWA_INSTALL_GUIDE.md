# PWA 安装功能使用指南

## 功能概述

本项目已成功集成 PWA（Progressive Web App）安装功能，用户可以将「包子与烧卖」网站安装到桌面或主屏幕，获得类似原生应用的体验。

## 新增功能

### 1. 自动弹出安装提示（PWAInstallPrompt）

- **位置**：网站底部右侧
- **触发条件**：
  - 浏览器支持 PWA 安装
  - 用户未安装应用
  - 用户未手动关闭过提示
- **功能**：
  - 显示精美的安装提示卡片
  - 提供"立即安装"和"暂不安装"按钮
  - 用户关闭后会记住选择（存储在 localStorage）
  - 安装成功后自动隐藏

### 2. 手动安装按钮（PWAInstallButton）

- **位置**：
  - 首页右上角（在主题切换按钮旁边）
  - Dashboard 移动端顶部导航栏右侧
- **状态显示**：
  - 未安装且支持：显示"安装到桌面"按钮（带下载图标）
  - 已安装：按钮自动隐藏
  - 不支持安装：显示"已安装或不支持"（禁用状态）
- **功能**：
  - 点击后触发浏览器原生安装提示
  - 使用 toast 提示安装状态
  - 安装成功后自动隐藏按钮

## 技术实现

### 组件文件

1. **PWAInstallPrompt.tsx**
   - 自动弹出的安装提示卡片
   - 监听 `beforeinstallprompt` 事件
   - 管理安装状态和用户偏好

2. **PWAInstallButton.tsx**
   - 手动触发安装的按钮组件
   - 可复用，可放置在任何页面
   - 自动检测安装状态

### 集成位置

- `App.tsx`：添加全局安装提示
- `Home.tsx`：首页顶部工具栏添加安装按钮
- `DashboardLayout.tsx`：移动端导航栏添加安装按钮

### PWA 配置

项目已配置完整的 PWA 功能（在 `vite.config.ts`）：

- **manifest.json**：应用名称、图标、主题色等
- **Service Worker**：自动生成，支持离线缓存
- **图标资源**：
  - `icon-192.png`（192x192）
  - `icon-512.png`（512x512）
  - `apple-touch-icon.png`（180x180）

## 测试方法

### 桌面端测试（Chrome/Edge）

1. 启动开发服务器：
   ```bash
   pnpm dev
   ```

2. 在 Chrome/Edge 浏览器中打开网站

3. 测试自动提示：
   - 首次访问时，底部右侧应显示安装提示卡片
   - 点击"立即安装"可触发安装
   - 点击"暂不安装"会隐藏提示并记住选择

4. 测试手动按钮：
   - 首页右上角应显示"安装到桌面"按钮
   - 点击按钮触发安装提示
   - 安装后按钮自动隐藏

5. 验证安装：
   - 安装后，桌面/开始菜单会出现应用图标
   - 点击图标打开应用，应以独立窗口运行
   - 地址栏会显示应用图标而非完整 URL

### 移动端测试（iOS Safari/Android Chrome）

#### iOS Safari

1. 在 Safari 中打开网站
2. 点击分享按钮（底部中间的方框+箭头图标）
3. 选择"添加到主屏幕"
4. 确认添加

#### Android Chrome

1. 在 Chrome 中打开网站
2. 应自动显示底部安装提示横幅
3. 或点击右上角"安装到桌面"按钮
4. 确认安装

### 生产环境测试

1. 构建生产版本：
   ```bash
   pnpm build
   ```

2. 启动生产服务器：
   ```bash
   pnpm start
   ```

3. 使用 HTTPS 访问（PWA 要求 HTTPS）
4. 重复上述测试步骤

## 浏览器支持

### 完全支持
- Chrome 73+（桌面和移动端）
- Edge 79+
- Samsung Internet 11.2+
- Android WebView 73+

### 部分支持
- Safari 16.4+（iOS/macOS）
  - 需要手动通过"添加到主屏幕"安装
  - 不支持 `beforeinstallprompt` 事件

### 不支持
- Firefox（桌面端）
- 旧版浏览器

## 用户体验优化

1. **智能提示**：
   - 只在支持的浏览器显示安装功能
   - 已安装后自动隐藏所有安装入口
   - 记住用户关闭提示的选择

2. **视觉设计**：
   - 安装按钮使用渐变色，与应用主题一致
   - 提示卡片采用卡片设计，带有品牌色边框
   - 响应式设计，适配移动端和桌面端

3. **反馈提示**：
   - 使用 toast 提示安装状态
   - 清晰的按钮文案和图标

## 注意事项

1. **HTTPS 要求**：PWA 必须在 HTTPS 环境下运行（localhost 除外）
2. **图标准备**：确保 `public/` 目录下有所需的图标文件
3. **Service Worker**：首次访问后，Service Worker 会在后台注册
4. **更新机制**：应用更新后，Service Worker 会自动更新缓存

## 故障排除

### 安装按钮不显示

- 检查是否使用 HTTPS
- 检查浏览器是否支持 PWA
- 检查是否已经安装过应用
- 打开浏览器控制台查看错误信息

### 安装后无法打开

- 检查 manifest.json 配置是否正确
- 检查 start_url 是否可访问
- 清除浏览器缓存后重试

### Service Worker 未注册

- 检查 vite-plugin-pwa 配置
- 确保生产环境构建正确
- 查看浏览器 Application 标签页的 Service Workers 部分

## 后续优化建议

1. **离线支持**：配置更完善的离线缓存策略
2. **推送通知**：添加 Web Push 通知功能
3. **后台同步**：实现后台数据同步
4. **更新提示**：当应用有新版本时提示用户更新
